# UltraLife Protocol

**Management Software for Life on Earth**

*"The bar for participation is: can you talk?"*

## What This Is

UltraLife is a parallel economy protocol on Cardano. 27 Aiken validators handle identity, marketplace, impact tracking, bioregion governance, sharing economy, and UBI. Users interact through conversation with any LLM via MCP — no app, no UI, just talk.

The **Waveform Identity** module adds biometric authentication to the existing pNFT identity system. Your body's waveform signature (cardiac rhythm, movement patterns, touch dynamics) replaces passwords and seed phrases. Your heartbeat authorizes transactions.

## Architecture

```
┌─────────────────────────────────────────────────────────────────┐
│  YOU: "I want to sell eggs from my farm"                        │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│  LLM (Claude, GPT, any) → MCP Server → Builds Transaction      │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│  WAVEFORM AUTH: Phone captures biometric → cosine similarity    │
│  → confidence ≥ threshold → private key decrypted               │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│  YOUR WALLET: Biometric-gated signing (no seed phrase needed)   │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│  CARDANO: 28 validators enforce rules, transaction recorded     │
└─────────────────────────────────────────────────────────────────┘
```

**LLM = convenience layer (can build, can't sign)**
**Biometric = authentication layer (your body gates the key)**
**Wallet = security layer (you control keys)**
**Chain = truth layer (validators enforce rules)**

## Repository Structure

```
ultralife-protocol/
│
├── CLAUDE.md                    ← You are here. Claude Code reads this first.
├── aiken.toml                   ← Aiken project config (all validators)
├── aiken.lock                   ← Aiken dependency lock
├── plutus.json                  ← Compiled validator blueprints (generated by aiken build)
├── protocol-spec.json           ← Protocol specification data
├── LICENSE
├── README.md
├── CONTRIBUTING.md
├── .gitignore
│
├── lib/                         ← Shared Aiken libraries (existing)
│
├── validators/                  ← 28 Aiken validators (compiled to plutus.json)
│   ├── pnft.ak                 ← One identity per human (existing)
│   ├── recovery.ak             ← Identity recovery (existing)
│   ├── biometric.ak            ← NEW: Waveform biometric gate for pNFT
│   ├── token.ak                ← ULTRA token (existing)
│   ├── treasury.ak             ← Treasury management (existing)
│   ├── marketplace.ak          ← Buy/sell (existing)
│   ├── work_auction.ak         ← Labor marketplace (existing)
│   ├── records.ak              ← Data storage (existing)
│   ├── registry.ak             ← Entity registry (existing)
│   ├── memory.ak               ← Protocol memory (existing)
│   ├── bioregion.ak            ← Ecological governance (existing)
│   ├── land_rights.ak          ← Land management (existing)
│   ├── commons.ak              ← Shared resources (existing)
│   ├── stake_pool.ak           ← ULTRA staking (existing)
│   ├── governance.ak           ← Voting (existing)
│   ├── ubi.ak                  ← Universal basic income (existing)
│   ├── impact.ak               ← Impact tracking (existing)
│   ├── impact_market.ak        ← Impact markets (existing)
│   ├── asset_impact.ak         ← Asset impact (existing)
│   ├── remediation.ak          ← Negative impact remediation (existing)
│   ├── preservation.ak         ← Conservation (existing)
│   ├── collective.ak           ← Organizations (existing)
│   ├── care.ak                 ← Mutual aid (existing)
│   ├── energy.ak               ← Energy grid (existing)
│   ├── grants.ak               ← Funding (existing)
│   ├── genesis.ak              ← Protocol bootstrap (existing)
│   ├── spending_bucket.ak      ← Hydra L2 (existing)
│   ├── ultralife_validator.ak  ← Hydra validator (existing)
│   └── fee_pool.ak             ← Hydra fees (existing)
│
├── service/                     ← MCP service (existing)
│   ├── indexer/                 ← Read chain state via Blockfrost
│   ├── builder/                 ← Construct unsigned transactions
│   └── mcp/                    ← 31+ tools for LLM interaction
│
├── src/                         ← NEW: Application code
│   ├── biometrics/              ← Waveform identity engines
│   │   ├── cardiac.ts           ← PPG processing, 43 cardiac features
│   │   ├── movement.ts          ← Accelerometer, 30 movement features
│   │   └── touch.ts             ← Screen interaction, 25 touch features
│   ├── lib/                     ← Core identity logic
│   │   ├── identity.ts          ← Enrollment, auth, continuous auth
│   │   ├── math.ts              ← Cosine similarity, vector ops, FFT
│   │   ├── types.ts             ← All type definitions
│   │   └── storage.ts           ← Encrypted on-device biometric storage
│   ├── cardano/                 ← Wallet integration
│   │   └── wallet.ts            ← Biometric-gated Cardano wallet
│   └── app/                     ← Mobile app screens (Expo Router)
│       ├── _layout.tsx
│       ├── index.tsx
│       └── enroll.tsx
│
├── docs/                        ← Documentation
│   ├── INVISIBLE_INTERFACE.md   ← No app, no UI philosophy (existing)
│   ├── WHAT_IT_DOES.md          ← System overview (existing)
│   ├── WAVEFORM_IDENTITY.md     ← NEW: Biometric identity spec
│   ├── ... (20+ existing docs)
│   └── ultralife-waveform-identity.pdf  ← NEW: Full technical spec
│
├── scripts/                     ← Deployment and utility scripts
│
└── tests/                       ← NEW: Test suite
    └── math.test.ts             ← Cosine similarity, peaks, entropy tests
```

## The 28 Validators

| Category | Validators | Purpose |
|----------|-----------|---------|
| **Identity** | pnft, recovery, **biometric** | One identity per human, recovery, **waveform auth gate** |
| **Token** | token, treasury | ULTRA token, treasury management |
| **Marketplace** | marketplace, work_auction | Buy/sell, labor marketplace |
| **Records** | records, registry, memory | Data storage, entity registry, protocol memory |
| **Bioregion** | bioregion, land_rights, commons | Ecological governance, land, shared resources |
| **Staking** | stake_pool, governance, ubi | ULTRA staking, voting, universal basic income |
| **Impact** | impact, impact_market, asset_impact, remediation, preservation | Chemical compound tracking, impact markets |
| **Collectives** | collective, care | Organizations, mutual aid |
| **Infrastructure** | energy, grants, genesis | Energy grid, funding, protocol bootstrap |
| **Hydra** | spending_bucket, ultralife_validator, fee_pool | L2 scaling, fast payments |

## How Waveform Identity Connects to Existing System

### pNFT + Biometric
The existing `pnft.ak` creates one identity per human. The new `biometric.ak` adds a biometric authentication gate. The pNFT stays — it gains a waveform lock.

```
BEFORE:  pNFT → wallet signature → transaction
AFTER:   pNFT → waveform auth → wallet signature → transaction
```

The biometric validator checks:
1. Live biometric hash differs from enrollment hash (anti-replay)
2. Confidence score meets threshold for operation type
3. Authentication timestamp is fresh (within 5 min)
4. Device signature matches enrolled device

### MCP Service + Biometric
The existing MCP service (31 tools) continues to build unsigned transactions from conversation. The biometric layer sits between "MCP builds tx" and "wallet signs tx." No MCP changes needed — the auth happens at the wallet level.

New MCP tools to add (extends existing 31):
- `enroll_biometric` — Initiate enrollment ceremony
- `check_biometric_status` — Query enrollment status
- `authenticate_biometric` — Trigger biometric auth at specified level

### Recovery + Biometric
The existing `recovery.ak` handles identity recovery. Biometric adds a new recovery path: social recovery via Shamir secret sharing where each fragment is biometric-gated on the holder's device.

### Invisible Interface + Biometric
The invisible interface philosophy (no app, no UI, just conversation) extends to authentication. You don't type a password. You don't enter a PIN. You hold your phone. It reads you. You're in.

## Tech Stack

### Existing
- **Smart Contracts**: Aiken (28 validators, Cardano)
- **MCP Service**: Node.js (indexer + builder + 31 tools)
- **Chain Interaction**: Blockfrost API

### New (Waveform Identity)
- **Mobile**: React Native + Expo (iOS + Android)
- **Biometrics**: expo-camera (PPG), expo-sensors (accel/gyro), native touch events
- **Crypto**: @emurgo/cardano-serialization-lib, Shamir secret sharing
- **Storage**: expo-secure-store (encrypted on-device)

## Coding Standards

### Aiken Contracts
- Follow existing contract patterns in `validators/`
- biometric.ak follows same datum/redeemer structure as pnft.ak
- All new validators must have test cases

### TypeScript (src/)
- Strict mode everywhere
- Functional components, hooks only
- No default exports except screen components
- All biometric processing happens on-device, never network

### Biometric Engine Rules (CRITICAL)
- Every feature extraction function must be pure: `(raw_signal) → feature_vector`
- Feature vectors are `Float64Array` for precision
- Cosine similarity is the ONLY distance metric for authentication
- Raw biometric features NEVER leave device. Only hashes + confidence on-chain.
- Feature vectors in memory must be zeroed after auth check completes
- `console.log` must NEVER contain biometric data, even in dev

### Privacy Rules (CRITICAL)
- No analytics SDK. No tracking. No telemetry.
- No network requests except Cardano node interaction
- Biometric data classified as SENSITIVE — encrypted at rest, zeroed after use

## Authentication Levels

| Level | Modalities | Time | Threshold | Use |
|-------|-----------|------|-----------|-----|
| Quick | touch + accel | 2s | θ=0.80 | App unlock, balance check |
| Standard | + PPG (5 beats) | 8s | θ=0.90 | Transactions, marketplace |
| High | + voice | 30s | θ=0.95 | Large transactions, governance votes |
| Forensic | All modalities | 60s | θ=0.98 | Identity verification, evidence |

## Current Phase

**Phone MVP** (Month 1-3). Focus areas:
1. PPG signal capture and cardiac feature extraction via phone camera
2. Enrollment ceremony (60-second flow)
3. Quick + Standard authentication
4. Integration with existing pNFT and wallet signing
5. Continuous authentication (accel + touch background monitoring)
6. Add 3 biometric MCP tools to existing service

## What NOT To Build Yet
- Mesh networking (Crystal hardware phase)
- Impedance spectroscopy (Crystal hardware phase)
- Forensic evidence framework (Phone v2)
- Genotype inference (Phase 3-4 research)
- Voice enrollment (Phase 2 — camera PPG is priority)

## Key Files to Understand First

### Existing (read these to understand the system)
1. `docs/INVISIBLE_INTERFACE.md` — The conversation-first philosophy
2. `docs/WHAT_IT_DOES.md` — Complete system overview
3. `validators/pnft.ak` — The existing identity validator
4. `service/` — MCP service architecture

### New (the waveform identity module)
5. `src/lib/identity.ts` — Core identity manager (enrollment, auth, continuous)
6. `src/biometrics/cardiac.ts` — PPG signal processing, 43 features
7. `src/cardano/wallet.ts` — Biometric-gated signing
8. `validators/biometric.ak` — On-chain biometric validator (#28)
9. `docs/ultralife-waveform-identity.pdf` — Full technical specification

## Build & Run

```bash
# Existing: Build all 28 validators
cd validators && aiken build

# Existing: Run MCP service
cd service && npm install && npm start

# New: Install biometric module dependencies
npm install

# New: Start Expo dev server (mobile app)
npx expo start

# New: Run biometric tests
npm test
```

## Core Concept: Eigenvector Identity

Your biometric waveform is an eigenvector — the direction that persists under daily transformations (sleep, exercise, stress). Authentication checks cosine similarity between live reading and enrolled template. The eigenvalue is the confidence score.

```
auth(W_live) = true  iff  cos(I_enrolled, Φ(W_live)) > θ
```

Where:
- `I_enrolled` = enrolled identity vector (~200 dimensions)
- `Φ(W_live)` = feature extraction from live biometric
- `θ` = threshold for requested auth level
- The biometric feature vector NEVER appears on-chain — only its hash

## The Convergence Path

```
Phone (now)     → Fingerprint-grade identity. Seed phrase eliminated.
Crystal v1      → DNA-STR-grade. Health monitoring emerges as byproduct.
Crystal v2      → Beyond DNA. Tissue composition. Genotype inference begins.
Crystal v3      → Waveform reading predicts genetic variants. DNA test without DNA.
```

The phone MVP validates the identity architecture and builds the user base.
When the crystal ships, enrolled users upgrade seamlessly.
The pNFT stays. The auth layer deepens. Same eigenvector, bigger eigenvalue.
